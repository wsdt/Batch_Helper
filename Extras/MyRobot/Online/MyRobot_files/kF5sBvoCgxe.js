/*!CK:3305927522!*//*1401172107,178187597*/

if (self.CavalryLogger) { CavalryLogger.start_js(["E0eWs"]); }

__d("SaveState",[],function(a,b,c,d,e,f){var g={SAVING:'saving',SAVED:'saved',UNSAVING:'unsaving',UNSAVED:'unsaved'};e.exports=g;},null);
__d("SaveStateHandler",["Run","SaveState"],function(a,b,c,d,e,f,g,h){var i=null;function j(){"use strict";this.$SaveStateHandler0={};this.$SaveStateHandler1={};g.onLeave(function(){i=null;});}j.prototype.addListener=function(k,l){"use strict";k.forEach(function(m){if(!this.$SaveStateHandler0[m])this.$SaveStateHandler0[m]=[];this.$SaveStateHandler0[m].push(l);},this);};j.prototype.setState=function(k,l){"use strict";k.forEach(function(m){this.$SaveStateHandler1[m]=l;if(!this.$SaveStateHandler0[m])return;var n=this.$SaveStateHandler0[m];n.forEach(function(o){try{o.call(window,l,m);}catch(p){}});},this);};j.prototype.getState=function(k){"use strict";var l={};k.forEach(function(m){l[m]=this.$SaveStateHandler1[m];},this);return l;};j.$SaveStateHandler2=function(){"use strict";if(!i)i=new j();return i;};j.listen=function(k,l){"use strict";this.$SaveStateHandler2().addListener(k,l);};j.getState=function(k){"use strict";this.$SaveStateHandler2().getState(k);};j.saving=function(k){"use strict";this.$SaveStateHandler2().setState(k,h.SAVING);};j.saved=function(k){"use strict";this.$SaveStateHandler2().setState(k,h.SAVED);};j.unsaving=function(k){"use strict";this.$SaveStateHandler2().setState(k,h.UNSAVING);};j.unsaved=function(k){"use strict";this.$SaveStateHandler2().setState(k,h.UNSAVED);};j.isSaveAction=function(k){"use strict";var l=this.$SaveStateHandler2().getState(k);for(var m in l){var n=l[m];if(n==h.UNSAVED||n==h.UNSAVING)return true;}return false;};e.exports=j;},null);
__d("CurationOneClickButton",["Banzai","CSS","cx","Event","SaveState","SaveStateHandler","tidyEvent"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n="saved_for_later:click",o="remove",p="_vu",q="_vv";function r(s,t,u,v,w,x){"use strict";this.$CurationOneClickButton0=false;m([j.listen(t,'click',this.setSaving.bind(this,v)),j.listen(u,'click',this.logFlyoutClick.bind(this,x)),w.subscribe('itemclick',function(y,z){var aa=z.item.getValue();if(aa==o)this.setUnsaving(v);}.bind(this))]);l.listen([v],function(y){switch(y){case k.SAVING:h.addClass(s,p);h.addClass(w.getRoot(),q);this.$CurationOneClickButton0=true;break;case k.SAVED:h.removeClass(w.getRoot(),q);this.$CurationOneClickButton0=false;break;case k.UNSAVING:h.removeClass(s,p);h.addClass(s,q);t.setAttribute('rel','');this.$CurationOneClickButton0=true;break;case k.UNSAVED:h.removeClass(s,q);t.setAttribute('rel','async-post');this.$CurationOneClickButton0=false;break;}}.bind(this));}r.prototype.setSaving=function(s){"use strict";if(!this.$CurationOneClickButton0)l.saving([s]);};r.prototype.setUnsaving=function(s){"use strict";if(!this.$CurationOneClickButton0)l.unsaving([s]);};r.prototype.logFlyoutClick=function(s){"use strict";g.post(n,{og_object_id:s.og_object_id,collection_id:s.collection_id,surface:s.surface,mechanism:s.mechanism});};e.exports=r;},null);
__d("SaveCaretMenuItem",["Banzai","CSS","cx","DOM","MenuItem","SaveState","SaveStateHandler"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n='saved_for_later:caret_action',o='click',p='imp';for(var q in k)if(k.hasOwnProperty(q))s[q]=k[q];var r=k===null?null:k.prototype;s.prototype=Object.create(r);s.prototype.constructor=s;s.__superConstructor__=k;function s(t){"use strict";k.call(this,t);this._updateData();m.listen(t.ogobjectids,function(u){this._updateData();this._doRender(u);}.bind(this));}s.prototype.handleClick=function(){"use strict";var t=r.handleClick.call(this),u=this._data.logdata;g.post(n,{action:o,collection_id:u.collection_id,surface:u.surface,story_id:u.story_id,is_save:this._data.isSaveAction,is_multi:u.is_multi});if(this._data.isSaveAction){m.saving(this._data.ogobjectids);}else m.unsaving(this._data.ogobjectids);return t;};s.prototype._updateData=function(){"use strict";this._data.isSaveAction=m.isSaveAction(this._data.ogobjectids);if(this._data.isSaveAction){this._data.markup=this._data.savemarkup;this._data.ajaxify=this._data.saveajaxify;}else{this._data.markup=this._data.unsavemarkup;this._data.ajaxify=this._data.unsaveajaxify;}};s.prototype._doRender=function(t){"use strict";if(!this._root)return;switch(t){case l.SAVING:case l.UNSAVING:h.addClass(this._root,"_5arm");setTimeout(this.disable.bind(this),10);break;case l.SAVED:case l.UNSAVED:h.removeClass(this._root,"_5arm");setTimeout(this.enable.bind(this),10);break;}j.replace(this._anchor,this._renderItemContent());};s.prototype.onShow=function(){"use strict";var t=this._data.logdata;g.post(n,{action:p,collection_id:t.collection_id,surface:t.surface,story_id:t.story_id,is_save:this._data.isSaveAction,is_multi:t.is_multi});};e.exports=s;},null);